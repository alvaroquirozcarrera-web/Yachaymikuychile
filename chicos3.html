<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bienestar Psicológico - YachayMikuy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6a11cb;
            --secondary: #2575fc;
            --accent: #ff6b6b;
            --success: #4ecdc4;
            --warning: #ffd93d;
            --dark: #2c3e50;
            --light: #f8f9fa;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        /* Header */
        .header {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            text-decoration: none;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo i {
            font-size: 2rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: 600;
        }

        .user-info i {
            font-size: 1.2rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.5rem 1.25rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.2);
            transition: left 0.3s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 2px solid #e0e0e0;
        }

        .btn-danger {
            background: var(--accent);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        /* Hero Section */
        .hero {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .hero h1 {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.1rem;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Info Cards */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .info-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .info-card:hover {
            transform: translateY(-5px);
        }

        .info-card-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .info-card-icon i {
            font-size: 1.5rem;
            color: white;
        }

        .info-card h3 {
            color: var(--primary);
            margin-bottom: 0.75rem;
        }

        .info-card p {
            color: #666;
            line-height: 1.6;
        }

        /* Generator Section */
        .generator-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
        }

        .generator-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .generator-header h2 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        .input-group textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .input-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .generate-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* AI Development Message */
        .ai-development-message {
            background: linear-gradient(135deg, #fff9c4, #ffeb3b);
            color: #f57f17;
            padding: 1.5rem;
            border-radius: 15px;
            margin: 2rem 0;
            text-align: center;
            font-weight: 600;
            display: none;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            border: 2px solid #fbc02d;
            animation: slideDown 0.5s ease;
        }

        .ai-development-message.active {
            display: flex;
        }

        .ai-development-message i {
            font-size: 2rem;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Loading State */
        .loading-state {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading-state.active {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tips Grid */
        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .tip-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            position: relative;
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tip-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .tip-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .tip-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tip-icon i {
            font-size: 1.2rem;
            color: white;
        }

        .tip-actions {
            display: flex;
            gap: 0.5rem;
        }

        .tip-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            transition: transform 0.2s ease;
        }

        .tip-btn:hover {
            transform: scale(1.2);
        }

        .tip-btn.favorite {
            color: #ccc;
        }

        .tip-btn.favorite.active {
            color: var(--accent);
        }

        .tip-btn.copy {
            color: var(--primary);
        }

        .tip-content h3 {
            color: var(--primary);
            margin-bottom: 0.75rem;
            font-size: 1.2rem;
        }

        .tip-content p {
            color: #666;
            line-height: 1.6;
        }

        /* Favorites Section */
        .favorites-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            display: none;
        }

        .favorites-section.active {
            display: block;
        }

        .favorites-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .favorites-header h2 {
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
        }

        .toast {
            background: white;
            border-radius: 10px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 300px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--accent);
        }

        .toast.info {
            border-left: 4px solid var(--primary);
        }

        .toast i {
            font-size: 1.5rem;
        }

        .toast.success i {
            color: var(--success);
        }

        .toast.error i {
            color: var(--accent);
        }

        .toast.info i {
            color: var(--primary);
        }

        /* Chatbot */
        .chat-fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .chat-fab:hover {
            transform: scale(1.1);
        }

        .chat-widget {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 380px;
            height: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            transform: scale(0);
            transform-origin: bottom right;
            transition: transform 0.3s ease;
            z-index: 999;
        }

        .chat-widget.open {
            transform: scale(1);
        }

        .chat-header {
            background: var(--accent);
            color: white;
            padding: 1rem;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h3 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .chat-body {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .chat-message {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .chat-message.user {
            justify-content: flex-end;
        }

        .chat-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .chat-message.user .chat-avatar {
            background: var(--accent);
        }

        .chat-bubble {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 15px;
            background: white;
        }

        .chat-message.user .chat-bubble {
            background: var(--accent);
            color: white;
        }

        .chat-input {
            padding: 1rem;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 0.5rem;
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #e0e0e0;
            border-radius: 25px;
            outline: none;
        }

        .chat-input button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width:768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .tips-grid {
                grid-template-columns: 1fr;
            }

            .chat-widget {
                width: calc(100vw - 2rem);
                height: 70vh;
                right: 1rem;
                bottom: 1rem;
            }

            .chat-fab {
                bottom: 1rem;
                right: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="#" class="logo">
                <i class="fas fa-brain"></i>
                <span>YachayMikuy</span>
            </a>
            
            <div class="user-info" id="user-info">
                <i class="fas fa-user-circle"></i>
                <span id="user-name">Usuario</span>
            </div>
            
            <div class="header-actions">
                <a href="#" class="btn btn-secondary" id="back-btn">
                    <i class="fas fa-arrow-left"></i>
                    <span>Volver</span>
                </a>
                <a href="#" class="btn btn-danger" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Salir</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Hero Section -->
        <section class="hero">
            <h1>Bienestar Psicológico Infantil</h1>
            <p>Consejos personalizados para apoyar el desarrollo emocional de tu hijo y combatir los efectos de la anemia</p>
        </section>

        <!-- Info Cards -->
        <section class="info-grid">
            <div class="info-card">
                <div class="info-card-icon">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <h3>Anemia y Emociones</h3>
                <p>La anemia puede afectar el estado de ánimo, causando irritabilidad, fatiga y dificultad de concentración en los niños.</p>
            </div>
            <div class="info-card">
                <div class="info-card-icon">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <h3>Consejos Personalizados</h3>
                <p>Obtén recomendaciones psicológicas adaptadas a las necesidades específicas de tu hijo.</p>
            </div>
            <div class="info-card">
                <div class="info-card-icon">
                    <i class="fas fa-star"></i>
                </div>
                <h3>Guarda tus Favoritos</h3>
                <p>Guarda los consejos más útiles y accede a ellos rápidamente cuando los necesites.</p>
            </div>
        </section>

        <!-- Generator Section -->
        <section class="generator-section">
            <div class="generator-header">
                <h2>Generador de Consejos</h2>
                <p>Describe cómo se siente tu hijo y obtén consejos personalizados</p>
            </div>
            
            <div class="input-group">
                <label for="mood-input">¿Cómo se siente tu hijo hoy?</label>
                <textarea id="mood-input" placeholder="Ej: Hoy se sintió frustrado porque no pudo armar su juguete, está cansado o no quiere comer..."></textarea>
            </div>
            
            <button class="generate-btn" id="generate-btn">
                <i class="fas fa-magic"></i>
                <span>Generar Consejos</span>
            </button>
            
            <!-- AI Development Message -->
            <div class="ai-development-message" id="ai-development-message">
                <i class="fas fa-robot"></i>
                <span><strong>IA en desarrollo</strong> - Estamos generando consejos personalizados para tu hijo...</span>
            </div>
            
            <!-- Loading State -->
            <div class="loading-state" id="loading-state">
                <div class="spinner"></div>
                <p>Generando consejos personalizados para tu hijo...</p>
            </div>
        </section>

        <!-- Tips Grid -->
        <section class="tips-grid" id="tips-grid">
            <!-- Tips will be dynamically inserted here -->
        </section>

        <!-- Favorites Section -->
        <section class="favorites-section" id="favorites-section">
            <div class="favorites-header">
                <h2>
                    <i class="fas fa-star"></i>
                    <span>Mis Consejos Favoritos</span>
                </h2>
                <button class="btn btn-secondary" id="clear-favorites">
                    <i class="fas fa-trash"></i>
                    <span>Limpiar</span>
                </button>
            </div>
            <div class="tips-grid" id="favorites-grid">
                <!-- Favorite tips will be inserted here -->
            </div>
        </section>
    </main>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Chatbot -->
    <div class="chat-fab" id="chat-fab">
        <i class="fas fa-robot"></i>
    </div>
    <div class="chat-widget" id="chat-widget">
        <div class="chat-header">
            <h3>
                <i class="fas fa-robot"></i>
                <span>Asistente YachayMikuy</span>
            </h3>
            <button class="chat-close" id="chat-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="chat-body" id="chat-body">
            <!-- Chat messages will be inserted here -->
        </div>
        <div class="chat-input">
            <input type="text" id="chat-input" placeholder="Escribe tu pregunta...">
            <button id="chat-send">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <script>
        // Sistema de Usuarios y Niños
        const userSystem = {
            // Obtener usuario actual
            getCurrentUser: function() {
                const sessionData = localStorage.getItem('yachay_session');
                if (sessionData) {
                    const session = JSON.parse(sessionData);
                    if (session.currentUserId) {
                        const users = JSON.parse(localStorage.getItem('yachay_users') || '[]');
                        return users.find(u => u.id === session.currentUserId);
                    }
                }
                return null;
            },
            
            // Obtener todos los niños
            getChildren: function() {
                return JSON.parse(localStorage.getItem('yachay_children') || '[]');
            },
            
            // Obtener niño por ID
            getChildById: function(childId) {
                const children = this.getChildren();
                return children.find(c => c.id === childId);
            },
            
            // Cerrar sesión
            logout: function() {
                localStorage.removeItem('yachay_session');
                return true;
            }
        };

        // Database de consejos psicológicos
        const psychologicalTips = [
            {
                id: 1,
                title: "Respiración del Volcán",
                description: "Enséñale a tu hijo a respirar profundamente imaginando que es un volcán. Inhala por la nariz contando hasta 4, sostén el aire y exhala como lava. Repite 3-5 veces para calmar la ansiedad.",
                icon: "fa-wind"
            },
            {
                id: 2,
                title: "Frasco de la Calma",
                description: "Crea un frasco con agua, purpurina y glicerina. Cuando tu hijo se sienta ansioso, agítalo y observen juntos cómo la purpurina se asienta lentamente.",
                icon: "fa-prescription-bottle"
            },
            {
                id: 3,
                title: "Dibuja tus Emociones",
                description: "Invita a tu hijo a dibujar lo que siente usando colores. Después, hablen sobre el dibujo. Esto ayuda a expresar sentimientos difíciles de verbalizar.",
                icon: "fa-paint-brush"
            },
            {
                id: 4,
                title: "Cuentos Terapéuticos",
                description: "Crea historias donde personajes enfrenten situaciones similares. Tu hijo puede encontrar soluciones para sus propias emociones sintiéndose comprendido.",
                icon: "fa-book-open"
            },
            {
                id: 5,
                title: "Rincón de la Serenidad",
                description: "Dedica un espacio con cojines, libros tranquilos y música suave. Cuando tu hijo se sienta abrumado, puede ir allí para calmarse por sí mismo.",
                icon: "fa-couch"
            },
            {
                id: 6,
                title: "Juego de Roles",
                description: "Practica situaciones difíciles intercambiando roles. Tu hijo puede ver la perspectiva de otros y desarrollar estrategias para manejar sus emociones.",
                icon: "fa-theater-masks"
            },
            {
                id:7,
                title: "Combinación de Alimentos",
                description: "Combina alimentos ricos en hierro con vitamina C. Sirve lentejas con pimientos o espinacas con tomate para mejorar la absorción y enseñar nutrición visualmente.",
                icon: "fa-apple-alt"
            },
            {
                id: 8,
                title: "Cocina en Familia",
                description: "Involucra a tu hijo en preparar comidas ricas en hierro. Los niños que cocinan están más dispuestos a probar nuevos alimentos y fortalece los vínculos.",
                icon: "fa-utensils"
            },
            {
                id: 9,
                title: "Narrativa de Superhéroes",
                description: "Crea historias donde personajes obtienen superpoderes al comer alimentos ricos en hierro. Tu hijo puede imaginar que obtiene 'poderes de concentración'.",
                icon: "fa-mask"
            },
            {
                id: 10,
                title: "Tabla de Progresos",
                description: "Crea una tabla visual donde tu hijo marque cada vez que prueba un alimento rico en hierro. Celebre los logros para reforzar positivamente el comportamiento.",
                icon: "fa-chart-line"
            },
            {
                id: 11,
                title: "Tiempo de Calma Post-Comida",
                description: "Establece 10-15 minutos de relajación después de comer. Practiquen respiración profunda para mejorar la digestión y absorción de nutrientes.",
                icon: "fa-spa"
            },
            {
                id: 12,
                title: "Diario de Bienestar",
                description: "Ayuda a tu hijo a llevar un diario visual registrando cómo se siente antes y después de comer alimentos ricos en hierro para conectar nutrición y emociones.",
                icon: "fa-journal-whills"
            },
            {
                id: 13,
                title: "Juegos de Identificación",
                description: "Crea juegos donde tu hijo identifique alimentos 'energéticos'. Usa tarjetas con imágenes y haz competencias de quién encuentra más alimentos que dan fuerza.",
                icon: "fa-search"
            },
            {
                id: 14,
                title: "Premios No Alimenticios",
                description: "Recompensa el consumo de alimentos ricos en hierro con actividades especiales: tiempo extra de juego, una lectura juntos o una salida especial.",
                icon: "fa-trophy"
            },
            {
                id: 15,
                title: "Música y Alimentos",
                description: "Crea canciones sobre alimentos ricos en hierro. La música ayuda a memorizar información y crea asociaciones positivas con estos alimentos.",
                icon: "fa-music"
            },
            {
                id: 16,
                title: "Experimentos Culinarios",
                description: "Realiza experimentos simples como cambiar el color de alimentos (puré de papa con remolacha) para hacerlos más interesantes y despertar la curiosidad.",
                icon: "fa-flask"
            },
            {
                id: 17,
                title: "Visitas Educativas",
                description: "Visita granjas o mercados locales donde tu hijo pueda ver alimentos frescos ricos en hierro. Conocer el origen aumenta la disposición a probarlos.",
                icon: "fa-store"
            },
            {
                id: 18,
                title: "Amigos Imaginarios",
                description: "Inventa personajes que aman alimentos ricos en hierro. Tu hijo puede 'adoptar' a uno de estos amigos y querer comer como él, facilitando el cambio.",
                icon: "fa-ghost"
            }
        ];

        // Estado de la aplicación
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let displayedTips = [];
        let isGenerating = false;
        let currentUser = null;
        let currentChild = null;

        // DOM Elements
        const generateBtn = document.getElementById('generate-btn');
        const moodInput = document.getElementById('mood-input');
        const loadingState = document.getElementById('loading-state');
        const aiDevelopmentMessage = document.getElementById('ai-development-message');
        const tipsGrid = document.getElementById('tips-grid');
        const favoritesSection = document.getElementById('favorites-section');
        const favoritesGrid = document.getElementById('favorites-grid');
        const clearFavoritesBtn = document.getElementById('clear-favorites');
        const toastContainer = document.getElementById('toast-container');
        const userInfo = document.getElementById('user-info');
        const userName = document.getElementById('user-name');
        const backBtn = document.getElementById('back-btn');
        const logoutBtn = document.getElementById('logout-btn');

        // Chatbot Elements
        const chatFab = document.getElementById('chat-fab');
        const chatWidget = document.getElementById('chat-widget');
        const chatClose = document.getElementById('chat-close');
        const chatBody = document.getElementById('chat-body');
        const chatInput = document.getElementById('chat-input');
        const chatSend = document.getElementById('chat-send');

        // Base de conocimiento del chatbot
        const chatKnowledgeBase = {
            "hola": "¡Hola! Soy tu asistente de YachayMikuy. Estoy aquí para ayudarte con consejos sobre bienestar infantil y anemia.",
            "consejos": "Puedes generar consejos personalizados describiendo cómo se siente tu hijo en el área de texto y haciendo clic en 'Generar Consejos'.",
            "favoritos": "Para guardar un consejo como favorito, haz clic en la estrella ⭐ en la tarjeta del consejo. Puedes ver todos tus favoritos en la sección correspondiente.",
            "anemia": "La anemia puede afectar el estado emocional de los niños causando fatiga, irritabilidad y dificultad de concentración. Una buena nutrición ayuda a combatirla.",
            "emociones": "Es importante ayudar a los niños a identificar y expresar sus emociones. Usa técnicas como el dibujo, juegos de roles o cuentos terapéuticos."
        };

        // Inicialización
        function init() {
            loadUserData();
            setupEventListeners();
            updateFavoritesSection();
            addChatMessage("¡Hola! Soy tu asistente. ¿En qué puedo ayudarte hoy?", 'bot');
        }

        // Cargar datos del usuario y niño
        function loadUserData() {
            // Obtener usuario actual
            currentUser = userSystem.getCurrentUser();
            
            if (currentUser) {
                userName.textContent = currentUser.name;
                
                // Obtener childId de la URL
                const urlParams = new URLSearchParams(window.location.search);
                const childId = urlParams.get('childId');
                
                if (childId) {
                    currentChild = userSystem.getChildById(childId);
                    if (currentChild) {
                        userName.textContent = `${currentUser.name} - ${currentChild.name}`;
                    } else {
                        showToast('No se encontraron datos del niño', 'error');
                    }
                }
            } else {
                userName.textContent = "Invitado";
                showToast("No has iniciado sesión. Algunas funciones pueden estar limitadas.", 'info');
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            generateBtn.addEventListener('click', generateTips);
            clearFavoritesBtn.addEventListener('click', clearFavorites);
            
            // Navegación
            backBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (currentChild) {
                    window.location.href = `chicos.html?childId=${currentChild.id}`;
                } else {
                    window.location.href = 'index1.html';
                }
            });
            
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (userSystem.logout()) {
                    showToast('Sesión cerrada correctamente', 'success');
                    setTimeout(() => {
                        window.location.href = 'index1.html';
                    }, 1500);
                }
            });
            
            // Chatbot events
            chatFab.addEventListener('click', openChat);
            chatClose.addEventListener('click', closeChat);
            chatSend.addEventListener('click', sendChatMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendChatMessage();
            });
        }

        // Generar consejos
        function generateTips() {
            if (isGenerating) return;
            
            isGenerating = true;
            generateBtn.disabled = true;
            
            // Mostrar mensaje de IA en desarrollo
            aiDevelopmentMessage.classList.add('active');
            
            // Simular carga
            setTimeout(() => {
                aiDevelopmentMessage.classList.remove('active');
                loadingState.classList.add('active');
            }, 1000);
            
            // Simular procesamiento
            setTimeout(() => {
                const availableTips = psychologicalTips.filter(tip => 
                    !displayedTips.includes(tip.id)
                );
                
                // Si ya se mostraron todos, reiniciar
                const tipsToUse = availableTips.length > 0 ? availableTips : psychologicalTips;
                
                // Seleccionar 6 consejos aleatorios
                const selectedTips = [];
                const tempTips = [...tipsToUse];
                
                for (let i = 0; i < 6 && tempTips.length > 0; i++) {
                    const randomIndex = Math.floor(Math.random() * tempTips.length);
                    selectedTips.push(tempTips[randomIndex]);
                    displayedTips.push(tempTips[randomIndex].id);
                    tempTips.splice(randomIndex, 1);
                }
                
                // Mostrar consejos
                renderTips(selectedTips);
                
                // Limpiar input
                moodInput.value = '';
                
                // Ocultar loading
                loadingState.classList.remove('active');
                generateBtn.disabled = false;
                isGenerating = false;
                
                showToast('Se han generado 6 nuevos consejos psicológicos', 'success');
            }, 3000);
        }

        // Renderizar consejos
        function renderTips(tips) {
            tipsGrid.innerHTML = '';
            
            tips.forEach(tip => {
                const isFavorite = favorites.some(fav => fav.id === tip.id);
                const tipCard = createTipCard(tip, isFavorite);
                tipsGrid.appendChild(tipCard);
            });
        }

        // Crear tarjeta de consejo
        function createTipCard(tip, isFavorite) {
            const card = document.createElement('div');
            card.className = 'tip-card';
            
            card.innerHTML = `
                <div class="tip-header">
                    <div class="tip-icon">
                        <i class="fas ${tip.icon}"></i>
                    </div>
                    <div class="tip-actions">
                        <button class="tip-btn favorite ${isFavorite ? 'active' : ''}" data-id="${tip.id}">
                            <i class="fas fa-star"></i>
                        </button>
                        <button class="tip-btn copy" data-id="${tip.id}">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div class="tip-content">
                    <h3>${tip.title}</h3>
                    <p>${tip.description}</p>
                </div>
            `;
            
            // Event listeners
            const favoriteBtn = card.querySelector('.favorite');
            const copyBtn = card.querySelector('.copy');
            
            favoriteBtn.addEventListener('click', () => toggleFavorite(tip));
            copyBtn.addEventListener('click', () => copyTip(tip));
            
            return card;
        }

        // Alternar favorito
        function toggleFavorite(tip) {
            const index = favorites.findIndex(fav => fav.id === tip.id);
            
            if (index > -1) {
                favorites.splice(index, 1);
                showToast('Consejo eliminado de favoritos', 'info');
            } else {
                favorites.push(tip);
                showToast('Consejo añadido a favoritos', 'success');
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoritesSection();
            
            // Actualizar botón en la tarjeta actual
            const favoriteBtn = document.querySelector(`.favorite[data-id="${tip.id}"]`);
            if (favoriteBtn) {
                favoriteBtn.classList.toggle('active');
            }
        }

        // Copiar consejo
        function copyTip(tip) {
            const text = `${tip.title}\n\n${tip.description}`;
            
            navigator.clipboard.writeText(text).then(() => {
                showToast('Consejo copiado al portapapeles', 'success');
            }).catch(() => {
                showToast('Error al copiar el consejo', 'error');
            });
        }

        // Actualizar sección de favoritos
        function updateFavoritesSection() {
            if (favorites.length > 0) {
                favoritesSection.classList.add('active');
                favoritesGrid.innerHTML = '';
                
                favorites.forEach(tip => {
                    const tipCard = createTipCard(tip, true);
                    favoritesGrid.appendChild(tipCard);
                });
            } else {
                favoritesSection.classList.remove('active');
            }
        }

        // Limpiar favoritos
        function clearFavorites() {
            favorites = [];
            localStorage.removeItem('favorites');
            updateFavoritesSection();
            showToast('Todos los favoritos han sido eliminados', 'info');
            
            // Actualizar botones en las tarjetas actuales
            document.querySelectorAll('.favorite.active').forEach(btn => {
                btn.classList.remove('active');
            });
        }

        // Mostrar notificación toast
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = type === 'success' ? 'fa-check-circle' : 
                         type === 'error' ? 'fa-exclamation-circle' : 
                         'fa-info-circle';
            
            toast.innerHTML = `
                <i class="fas ${icon}"></i>
                <span>${message}</span>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Chatbot Functions
        function openChat() {
            chatWidget.classList.add('open');
            chatFab.style.display = 'none';
        }

        function closeChat() {
            chatWidget.classList.remove('open');
            chatFab.style.display = 'flex';
        }

        function addChatMessage(message, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'chat-avatar';
            avatar.innerHTML = sender === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';
            
            const bubble = document.createElement('div');
            bubble.className = 'chat-bubble';
            bubble.textContent = message;
            
            if (sender === 'user') {
                messageDiv.appendChild(bubble);
                messageDiv.appendChild(avatar);
            } else {
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(bubble);
            }
            
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function sendChatMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            
            addChatMessage(message, 'user');
            chatInput.value = '';
            
            // Buscar respuesta en la base de conocimiento
            setTimeout(() => {
                const response = getChatbotResponse(message);
                addChatMessage(response, 'bot');
            }, 500);
        }

        function getChatbotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            for (const key in chatKnowledgeBase) {
                if (lowerMessage.includes(key)) {
                    return chatKnowledgeBase[key];
                }
            }
            
            return "No entiendo tu pregunta. Intenta preguntar sobre consejos, favoritos, anemia o emociones.";
        }

        // Inicializar aplicación
        init();
    </script>
</body>
</html> 